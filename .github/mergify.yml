queue_rules:
  - name: default queue
    conditions:
      - label!=work-in-progress
      - label!=wip
      - status-success~=^build\s\(.*\)$
  - name: release queue

pull_request_rules:
  - name: automatic approval for release package PR
    conditions:
      - author~=^ConfluxBot$
      - base=dev
      - head=__release-pkg
    actions:
      review:
        type: APPROVE
        message: Automatically approving release package PR
  - name: automatic update PR with merge
    conditions:
      - -conflict
      - -draft
      - label!=work-in-progress
      - label!=wip
      - label!=no-auto-merge-updates
      - head!=dev
      - head!=main
    actions:
      update:
  - name: Automatic queue to dev on approval [low]
    conditions:
      - "#approved-reviews-by>=1"
      - "#check-failure=0"
      - "#check-pending=0"
      - label!=work-in-progress
      - label!=wip
      - label!=no-auto-squash-merge
      - base=dev
      - head!=next
      - -conflict
      - -draft
      - -locked
      - "#review-threads-unresolved=0"
    actions:
      queue:
        name: default queue
        method: squash
  - name: Automatic queue to release on approval [low]
    conditions:
      - author~=^ConfluxBot$
      - "#approved-reviews-by>=1"
      - label!=work-in-progress
      - label!=wip
      - label!=no-auto-squash-merge
      - base=dev
      - head=__release-pkg
      - -conflict
      - -draft
      - -locked
    actions:
      queue:
        name: release queue
        method: squash
